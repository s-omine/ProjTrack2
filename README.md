# CopilotKit + PydanticAI Starter

This is a starter template for building AI agents using [PydanticAI](https://ai.pydantic.dev/) and [CopilotKit](https://copilotkit.ai). This project demonstrates an AI-powered application with generative UI, frontend actions, human-in-the-loop interactions, and shared state management.

## Project Overview

**ProjTrack2** is an AI-powered web application built with Next.js, featuring:

- ðŸ¤– **AI Agent Backend** (PydanticAI): Python-based agent that manages state and tools
- ðŸŽ¨ **Modern Frontend** (Next.js + React): Interactive UI with CopilotKit integration
- ðŸ”„ **Shared State Management**: Real-time state synchronization between frontend and backend
- âœ¨ **Generative UI**: Dynamic UI components generated by AI
- ðŸ›¡ï¸ **Human-in-the-Loop**: Interactive confirmation workflows
- ðŸŽ¯ **Frontend Actions**: AI-driven theme and UI manipulation

## Prerequisites

- OpenAI API Key (for the PydanticAI agent)
- Python 3.12+
- uv
- Node.js 20+ 
- Any of the following package managers:
  - pnpm (recommended)
  - npm
  - yarn
  - bun

> **Note:** This repository ignores lock files (package-lock.json, yarn.lock, pnpm-lock.yaml, bun.lockb) to avoid conflicts between different package managers. Each developer should generate their own lock file using their preferred package manager. After that, make sure to delete it from the .gitignore.

## Getting Started

1. Install dependencies using your preferred package manager:
```bash
# Using pnpm (recommended)
pnpm install

# Using npm
npm install

# Using yarn
yarn install

# Using bun
bun install
```

> **Note:** This will automatically setup the Python environment as well.
>
> If you have manual isseus, you can run:
>
> ```sh
> npm run install:agent
> ```


3. Set up your OpenAI API key:

Create a `.env` file inside the `agent` folder with the following content:

```
OPENAI_API_KEY=sk-...your-openai-key-here...
```


4. Start the development server:
```bash
# Using pnpm
pnpm dev

# Using npm
npm run dev

# Using yarn
yarn dev

# Using bun
bun run dev
```

This will start both the UI and agent servers concurrently.

## Available Scripts
The following scripts can also be run using your preferred package manager:
- `dev` - Starts both UI and agent servers in development mode
- `dev:debug` - Starts development servers with debug logging enabled
- `dev:ui` - Starts only the Next.js UI server
- `dev:agent` - Starts only the PydanticAI agent server
- `build` - Builds the Next.js application for production
- `start` - Starts the production server
- `lint` - Runs ESLint for code linting
- `install:agent` - Installs Python dependencies for the agent

## Architecture

### Component Structure

```
projtrack/
â”œâ”€â”€ agent/                    # Python PydanticAI Agent
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ agent.py         # Agent definition with tools and state
â”‚   â”‚   â””â”€â”€ main.py          # FastAPI server entry point
â”‚   â””â”€â”€ pyproject.toml        # Python dependencies
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/copilotkit/  # CopilotKit API route
â”‚   â”‚   â”œâ”€â”€ page.tsx         # Main application UI
â”‚   â”‚   â””â”€â”€ layout.tsx       # Root layout with CopilotKit provider
â”‚   â”‚
â”‚   â”œâ”€â”€ components/          # React components
â”‚   â”‚   â”œâ”€â”€ proverbs.tsx     # Proverbs card with state management
â”‚   â”‚   â”œâ”€â”€ weather.tsx      # Generative weather UI component
â”‚   â”‚   â””â”€â”€ moon.tsx         # Human-in-the-loop moon mission component
â”‚   â”‚
â”‚   â””â”€â”€ lib/
â”‚       â””â”€â”€ types.ts         # TypeScript type definitions
```

### Key Features

#### 1. **Shared State Management** 
The agent manages a `ProverbsState` that is synchronized between frontend and backend.

**Agent (Python):**
```python
class ProverbsState(BaseModel):
    proverbs: list[str] = Field(default_factory=list)
```

**Frontend (React):**
```typescript
const { state, setState } = useCoAgent<AgentState>({
    name: "my_agent",
    initialState: { proverbs: [...] }
})
```

#### 2. **Generative UI**
The agent can generate UI components dynamically based on context.

**Example:** Weather card rendered by AI tool call:
```typescript
useCopilotAction({
    name: "get_weather",
    render: ({ args }) => <WeatherCard location={args.location} />
})
```

#### 3. **Frontend Actions**
Allow the AI to manipulate the UI directly.

**Example:** Theme color changer:
```typescript
useCopilotAction({
    name: "setThemeColor",
    handler({ themeColor }) { setThemeColor(themeColor); }
})
```

#### 4. **Human-in-the-Loop**
Interactive workflows that require user confirmation.

**Example:** Moon mission with launch/abort buttons requires user decision.

### Agent Tools

The PydanticAI agent has the following tools:

- `get_proverbs()` - Retrieve current proverbs list
- `add_proverbs(proverbs: list[str])` - Add new proverbs
- `set_proverbs(proverbs: list[str])` - Replace all proverbs
- `get_weather(location: str)` - Get weather for a location (returns static data)

### Frontend Actions

- `setThemeColor(themeColor: string)` - Change the UI theme color
- `get_weather(location: string)` - Generate weather card UI
- `go_to_moon()` - Show moon mission confirmation dialog

## Documentation

The main UI component is in `src/app/page.tsx`. You can:
- Modify the theme colors and styling
- Add new frontend actions
- Customize the CopilotKit sidebar appearance
- Extend the agent's tools in `agent/src/agent.py`

## ðŸ“š Documentation

- [PydanticAI Documentation](https://ai.pydantic.dev) - Learn more about PydanticAI and its features
- [CopilotKit Documentation](https://docs.copilotkit.ai) - Explore CopilotKit's capabilities
- [Next.js Documentation](https://nextjs.org/docs) - Learn about Next.js features and API

## Example Interactions

Try these prompts in the CopilotKit chat:

1. **"Add a proverb about wisdom"** - Demonstrates agent state management
2. **"Get the weather in Paris"** - Shows generative UI
3. **"Set the theme to green"** - Demonstrates frontend actions
4. **"Please go to the moon"** - Shows human-in-the-loop workflow
5. **"What are the proverbs?"** - Shows agent reading state

## Contributing

Feel free to submit issues and enhancement requests! This starter is designed to be easily extensible.

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Troubleshooting

### Agent Connection Issues
If you see "I'm having trouble connecting to my tools", make sure:
1. The PydanticAI agent is running on port 8000
2. Your OpenAI API key is set correctly
3. Both servers started successfully

### Python Dependencies
If you encounter Python import errors:
```bash
cd agent
uv sync
uv run src/main.py
```